server {
    listen 80;

    # 1. 处理静态文件（你的 React 页面）
    location / {
        root   /usr/share/nginx/html;
        index  index.html index.htm;
        # 关键配置：如果找不到文件，就返回 index.html。解决 React 路由刷新 404 问题
        try_files $uri $uri/ /index.html; 
    }

    # 2. 处理 API 请求（反向代理到后端容器）
    location /api/ {
        # 核心逻辑：转发给内部 Docker 网络中的 backend 容器
        # 注意结尾的斜杠 '/' 极其重要！它等同于 Vite 的 rewrite，会削掉 /api 前缀
        proxy_pass http://backend:8000/;
        
        # 传递真实的用户信息给后端
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }
}